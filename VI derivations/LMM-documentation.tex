\documentclass[10pt]{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{latexsym} 
\usepackage{color}
%\usepackage{epsfig}
\usepackage{graphicx}
%\usepackage[dvips]{graphicx}

\usepackage[matrix,tips,graph,curve]{xy}

\newcommand{\mnote}[1]{${}^*$\marginpar{\footnotesize ${}^*$#1}}
\linespread{1.065}

\makeatletter

\setlength\@tempdima  {5.5in}
\addtolength\@tempdima {-\textwidth}
\addtolength\hoffset{-0.5\@tempdima}
\setlength{\textwidth}{5.5in}
\setlength{\textheight}{8.75in}
\addtolength\voffset{-0.625in}

\makeatother

\makeatletter 
\@addtoreset{equation}{section}
\makeatother

\setlength{\parindent}{0pt}

\renewcommand{\theequation}{\thesection.\arabic{equation}}



\theoremstyle{plain}
\newtheorem{theorem}[equation]{Theorem}
\newtheorem{corollary}[equation]{Corollary}
\newtheorem{lemma}[equation]{Lemma}
\newtheorem{proposition}[equation]{Proposition}
\newtheorem{conjecture}[equation]{Conjecture}
\newtheorem{fact}[equation]{Fact}
\newtheorem{facts}[equation]{Facts}
\newtheorem*{theoremA}{Theorem A}
\newtheorem*{theoremB}{Theorem B}
\newtheorem*{theoremC}{Theorem C}
\newtheorem*{theoremD}{Theorem D}
\newtheorem*{theoremE}{Theorem E}
\newtheorem*{theoremF}{Theorem F}
\newtheorem*{theoremG}{Theorem G}
\newtheorem*{theoremH}{Theorem H}

\theoremstyle{definition}
\newtheorem{definition}[equation]{Definition}
\newtheorem{definitions}[equation]{Definitions}
%\theoremstyle{remark}

\newtheorem{remark}[equation]{Remark}
\newtheorem{remarks}[equation]{Remarks}
\newtheorem{exercise}[equation]{Exercise}
\newtheorem{example}[equation]{Example}
\newtheorem{examples}[equation]{Examples}
\newtheorem{notation}[equation]{Notation}
\newtheorem{question}[equation]{Question}
\newtheorem{assumption}[equation]{Assumption}
\newtheorem*{claim}{Claim}
\newtheorem{answer}[equation]{Answer}
%%%%%% letters %%%%

\newcommand{\fA}{\mathfrak{A}}
\newcommand{\fB}{\mathfrak{B}}
\newcommand{\fC}{\mathfrak{C}}
\newcommand{\fD}{\mathfrak{D}}
\newcommand{\fE}{\mathfrak{E}}
\newcommand{\fF}{\mathfrak{F}}
\newcommand{\fG}{\mathfrak{G}}
\newcommand{\fH}{\mathfrak{H}}
\newcommand{\fI}{\mathfrak{I}}
\newcommand{\fJ}{\mathfrak{J}}
\newcommand{\fK}{\mathfrak{K}}
\newcommand{\fL}{\mathfrak{L}}
\newcommand{\fM}{\mathfrak{M}}
\newcommand{\fN}{\mathfrak{N}}
\newcommand{\fO}{\mathfrak{O}}
\newcommand{\fP}{\mathfrak{P}}
\newcommand{\fQ}{\mathfrak{Q}}
\newcommand{\fR}{\mathfrak{R}}
\newcommand{\fS}{\mathfrak{S}}
\newcommand{\fT}{\mathfrak{T}}
\newcommand{\fU}{\mathfrak{U}}
\newcommand{\fV}{\mathfrak{V}}
\newcommand{\fW}{\mathfrak{W}}
\newcommand{\fX}{\mathfrak{X}}
\newcommand{\fY}{\mathfrak{Y}}
\newcommand{\fZ}{\mathfrak{Z}}

\newcommand{\fa}{\mathfrak{a}}
\newcommand{\fb}{\mathfrak{b}}
\newcommand{\fc}{\mathfrak{c}}
\newcommand{\fd}{\mathfrak{d}}
\newcommand{\fe}{\mathfrak{e}}
\newcommand{\ff}{\mathfrak{f}}
\newcommand{\fg}{\mathfrak{g}}
\newcommand{\fh}{\mathfrak{h}}
%\newcommand{\fi}{\mathfrak{i}}

\newcommand{\fj}{\mathfrak{j}}
\newcommand{\fk}{\mathfrak{k}}
\newcommand{\fl}{\mathfrak{l}}
\newcommand{\fm}{\mathfrak{m}}
\newcommand{\fn}{\mathfrak{n}}
\newcommand{\fo}{\mathfrak{o}}
\newcommand{\fp}{\mathfrak{p}}
\newcommand{\fq}{\mathfrak{q}}
\newcommand{\fr}{\mathfrak{r}}
\newcommand{\fs}{\mathfrak{s}}
\newcommand{\ft}{\mathfrak{t}}
\newcommand{\fu}{\mathfrak{u}}
\newcommand{\fv}{\mathfrak{v}}
\newcommand{\fw}{\mathfrak{w}}
\newcommand{\fx}{\mathfrak{x}}
\newcommand{\fy}{\mathfrak{y}}
\newcommand{\fz}{\mathfrak{z}}


\newcommand{\sA}{\mathcal{A}\,}
\newcommand{\sB}{\mathcal{B}\,}
\newcommand{\sC}{\mathcal{C}}
\newcommand{\sD}{\mathcal{D}\,}
\newcommand{\sE}{\mathcal{E}\,}
\newcommand{\sF}{\mathcal{F}\,}
\newcommand{\sG}{\mathcal{G}\,}
\newcommand{\sH}{\mathcal{H}}
\newcommand{\sI}{\mathcal{I}\,}
\newcommand{\sJ}{\mathcal{J}\,}
\newcommand{\sK}{\mathcal{K}\,}
\newcommand{\sL}{\mathcal{L}\,}
\newcommand{\sM}{\mathcal{M}\,}
\newcommand{\sN}{\mathcal{N}}
\newcommand{\sO}{\mathcal{O}}
\newcommand{\sP}{\mathcal{P}\,}
\newcommand{\sQ}{\mathcal{Q}\,}
\newcommand{\sR}{\mathcal{R}}
\newcommand{\sS}{\mathcal{S}}
\newcommand{\sT}{\mathcal{T}\,}
\newcommand{\sU}{\mathcal{U}\,}
\newcommand{\sV}{\mathcal{V}\,}
\newcommand{\sW}{\mathcal{W}\,}
\newcommand{\sX}{\mathcal{X}\,}
\newcommand{\sY}{\mathcal{Y}\,}
\newcommand{\sZ}{\mathcal{Z}\,}

\newcommand{\IA}{\mathbb{A}}
\newcommand{\IB}{\mathbb{B}}
\newcommand{\IC}{\mathbb{C}}
\newcommand{\ID}{\mathbb{D}}
\newcommand{\IE}{\mathbb{E}}
\newcommand{\IF}{\mathbb{F}}
\newcommand{\IG}{\mathbb{G}}
\newcommand{\IH}{\mathbb{H}}
\newcommand{\II}{\mathbb{I}}
\newcommand{\IK}{\mathbb{K}}
\newcommand{\IL}{\mathbb{L}}
\newcommand{\IM}{\mathbb{M}}
\newcommand{\IN}{\mathbb{N}}
\newcommand{\IO}{\mathbb{O}}
\newcommand{\IP}{\mathbb{P}}
\newcommand{\IQ}{\mathbb{Q}}
\newcommand{\IR}{\mathbb{R}}
\newcommand{\IS}{\mathbb{S}}
\newcommand{\IT}{\mathbb{T}}
\newcommand{\IU}{\mathbb{U}}
\newcommand{\IV}{\mathbb{V}}
\newcommand{\IW}{\mathbb{W}}
\newcommand{\IX}{\mathbb{X}}
\newcommand{\IY}{\mathbb{Y}}
\newcommand{\IZ}{\mathbb{Z}}


 \newcommand{\tA}{\mathrm {A}}
 \newcommand{\tB}{\mathrm {B}}
 \newcommand{\tC}{\mathrm {C}}
 \newcommand{\tD}{\mathrm {D}}
 \newcommand{\tE}{\mathrm {E}}
 \newcommand{\tF}{\mathrm {F}}
 \newcommand{\tG}{\mathrm {G}}
 \newcommand{\tH}{\mathrm {H}}
 \newcommand{\tI}{\mathrm {I}}
 \newcommand{\tJ}{\mathrm {J}}
 \newcommand{\tK}{\mathrm {K}}
 \newcommand{\tL}{\mathrm {L}}
 \newcommand{\tM}{\mathrm {M}}
 \newcommand{\tN}{\mathrm {N}}
 \newcommand{\tO}{\mathrm {O}}
 \newcommand{\tP}{\mathrm {P}}
 \newcommand{\tQ}{\mathrm {Q}}
 \newcommand{\tR}{\mathrm {R}}
 \newcommand{\tS}{\mathrm {S}}
 \newcommand{\tT}{\mathrm {T}}
 \newcommand{\tU}{\mathrm {U}}
 \newcommand{\tV}{\mathrm {V}}
 \newcommand{\tW}{\mathrm {W}}
 \newcommand{\tX}{\mathrm {X}}
 \newcommand{\tY}{\mathrm {Y}}
 \newcommand{\tZ}{\mathrm {Z}}
%%%%%%% macros %%%%%

%% my definitions %%%

\newcommand{\End}{\mathrm{End}}
\newcommand{\tr}{\mathrm{tr}}
%\newcommand{\ind}{\mathrm{ind}}

\renewcommand{\index}{\mathrm{index \,}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\Aut}{\mathrm{Aut}}
\newcommand{\Trace}{\mathrm{Trace}\,}
\newcommand{\Res}{\mathrm{Res}\,}
\newcommand{\rank}{\mathrm{rank}}
%\renewcommand{\dim}{\mathrm{dim}}

\renewcommand{\deg}{\mathrm{deg}}
\newcommand{\spin}{\rm Spin}
\newcommand{\Spin}{\rm Spin}
\newcommand{\erfc}{\rm erfc\,}
\newcommand{\sgn}{\rm sgn\,}
\newcommand{\Spec}{\rm Spec\,}
\newcommand{\diag}{\rm diag\,}
\newcommand{\Fix}{\mathrm{Fix}}
\newcommand{\Ker}{\mathrm{Ker \,}}
\newcommand{\Coker}{\mathrm{Coker \,}}
\newcommand{\Sym}{\mathrm{Sym \,}}
\newcommand{\Hess}{\mathrm{Hess \,}}
\newcommand{\grad}{\mathrm{grad \,}}
\newcommand{\Center}{\mathrm{Center}}
\newcommand{\Lie}{\mathrm{Lie}}


\newcommand{\ch}{\rm ch} % Chern Character

\newcommand{\rk}{\rm rk} 
%\renewcommand{\c}{\rm c}  % Chern class

\newcommand{\sign}{\rm sign}
\renewcommand\dim{{\rm dim\,}}
\renewcommand\det{{\rm det\,}}
\newcommand{\dimKrull}{{\rm Krulldim\,}}
\newcommand\Rep{\mathrm{Rep}}
\newcommand\Hilb{\mathrm{Hilb}}
\newcommand\vol{\mathrm{vol}}

\newcommand\QED{\hfill $\Box$} %{\bf QED}} 

\newcommand\Pf{\nonintend{\em Proof. }}


\newcommand\reals{{\mathbb R}} 
\newcommand\complexes{{\mathbb C}}
\renewcommand\i{\sqrt{-1}}
\renewcommand\Re{\mathrm Re}
\renewcommand\Im{\mathrm Im}
\newcommand\integers{{\mathbb Z}}
\newcommand\quaternions{{\mathbb H}}


\newcommand\iso{{\cong}} 
\newcommand\tensor{{\otimes}}
\newcommand\Tensor{{\bigotimes}} 
\newcommand\union{\bigcup} 
\newcommand\onehalf{\frac{1}{2}}
%\newcommand\Sym[1]{{Sym^{#1}(\complexes^2)}}

\newcommand\lie[1]{{\mathfrak #1}} 
\renewcommand\fk{\mathfrak{K}}
\newcommand\smooth{\mathcal{C}^{\infty}}
\newcommand\trivial{{\mathbb I}}
\newcommand\widebar{\overline}

%%%%%Delimiters%%%%

\newcommand{\<}{\langle}
\renewcommand{\>}{\rangle}

%\renewcommand{\(}{\left(}
%\renewcommand{\)}{\right)}


%%%% Different kind of derivatives %%%%%

\newcommand{\delbar}{\bar{\partial}}
\newcommand{\pdu}{\frac{\partial}{\partial u}}
%\newcommand{\pd}[1][2]{\frac{\partial #1}{\partial #2}}

%%%%% Arrows %%%%%
%\renewcommand{\ra}{\rightarrow}                   % right arrow
%\newcommand{\lra}{\longrightarrow}              % long right arrow
%\renewcommand{\la}{\leftarrow}                    % left arrow
%\newcommand{\lla}{\longleftarrow}               % long left arrow
%\newcommand{\ua}{\uparrow}                     % long up arrow
%\newcommand{\na}{\nearrow}                      %  NE arrow
%\newcommand{\llra}[1]{\stackrel{#1}{\lra}}      % labeled long right arrow
%\newcommand{\llla}[1]{\stackrel{#1}{\lla}}      % labeled long left arrow
%\newcommand{\lua}[1]{\stackrel{#1}{\ua}}      % labeled  up arrow
%\newcommand{\lna}[1]{\stackrel{#1}{\na}}      % labeled long NE arrow

\newcommand{\into}{\hookrightarrow}
\newcommand{\tto}{\longmapsto}
\def\llra{\longleftrightarrow}

\def\d/{/\mspace{-6.0mu}/}
\newcommand{\git}[3]{#1\d/_{\mspace{-4.0mu}#2}#3}
\newcommand\zetahilb{\zeta_{{\text{Hilb}}}}
\def\Fy{\sF \mspace{-3.0mu} \cdot \mspace{-3.0mu} y}
\def\tv{\tilde{v}}
\def\tw{\tilde{w}}
\def\wt{\widetilde}
\def\wtilde{\widetilde}
\def\what{\widehat}

%%%%%%%%%%%%%%%%%%% Mark's definitions %%%%%%%%%%%%%%%%%%%%

\newcommand{\frakg}{\mbox{\frakturfont g}}
\newcommand{\frakk}{\mbox{\frakturfont k}}
\newcommand{\frakp}{\mbox{\frakturfont p}}
\newcommand{\q}{\mbox{\frakturfont q}}
\newcommand{\frakn}{\mbox{\frakturfont n}}
\newcommand{\frakv}{\mbox{\frakturfont v}}
\newcommand{\fraku}{\mbox{\frakturfont u}}
\newcommand{\frakh}{\mbox{\frakturfont h}}
\newcommand{\frakm}{\mbox{\frakturfont m}}
\newcommand{\frakt}{\mbox{\frakturfont t}}
\newcommand{\G}{\Gamma}
\newcommand{\g}{\gamma}
\newcommand{\fraka}{\mbox{\frakturfont a}}
\newcommand{\db}{\bar{\partial}}
\newcommand{\dbs}{\bar{\partial}^*}
\newcommand{\p}{\partial}

%%%%%%%%%%%%% Bryan's definitions %%%%%%%%%

\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\argmax}{arg\,max}
\newcommand{\Expect}{\mathbb{E}}
\newcommand{\Var}{\text{Var}}
\newcommand{\Prox}{\text{Prox}}


%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%
\begin{document}
%

\title{Linear mixed models}
\author{Bryan Liu}


\date{\today}

\maketitle
 

%\setcounter{secnumdepth}{1} 


\begin{align*}
y_{i}\vert u_{g},\beta & \sim\mathcal{N}\left(x_{i}^{T}\beta+u_{g\left[i\right]},\tau_{y}^{-1}\right)\\
u_{g} & \sim\mathcal{N}\left(\mu,\tau_{\mu}^{-1}\right)
\end{align*}


and 

\begin{align*}
y_{i}\vert v_{g},\beta,\mu & \sim\mathcal{N}\left(x_{i}^{T}\beta+v_{g\left[i\right]}+\mu,\tau_{y}^{-1}\right)\\
v_{g} & \sim\mathcal{N}\left(0,\tau_{\mu}^{-1}\right)
\end{align*}


certainly

\begin{align*}
v_{g}+\mu & =u_{g}
\end{align*}


in matrix form
\begin{align*}
Y & =X\beta+U_{g}+\epsilon\\
\log p\left(Y\vert X,\beta,U_{g}\right) & =-\frac{1}{2}\tau_{y}\left(Y-X\beta-U_{g}\right)^{T}\left(Y-X\beta-U_{g}\right)-\frac{N}{2}\log\tau_{y}\\
\left(Y-X\beta-U_{g}\right)^{T}\left(Y-X\beta-U_{g}\right) & =Y^{T}Y-2\left(X\beta+U_{g}\right)^{T}Y+\left(X\beta+U_{g}\right)^{T}\left(X\beta+U_{g}\right)\\
 & =Y^{T}Y-2Y^{T}X\beta-2Y^{T}U_{g}+\beta^{T}XX^{T}\beta+U_{g}^{T}U_{g}+2U_{g}^{T}X\beta
\end{align*}


Some of these can be efficiently precomputed.
 Obviously, there are $Y^{T}Y$, and $X^{T}X$.  Also, 
\begin{align*}
Y^{T}U_{g} & =\sum_{i}y_{i}u_{g\left[i\right]}\\
 & =\sum_{\gamma}u_{\gamma}\sum_{i:g\left[i\right]=\gamma}y_{i}
\end{align*}

and


\begin{align*}
U_{g}^{T}U_{g} & =\sum_{i}u_{g\left[i\right]}^{2}=\sum_{g}n_{g}u_{g}^{2}
\end{align*}

and\begin{align*}
U_{g}^{T}X & =\sum_{i}u_{g\left[i\right]}x_{i}^{T}\\
 & =\sum_{\gamma}u_{\gamma}\sum_{i:g\left[i\right]=\gamma}x_{i}^{T}
\end{align*}


So we additionally want to pre-compute

\begin{align*}
n_{g} & =\sum_{i:g\left[i\right]=\gamma}1\\
\bar{y}_{g} & =\sum_{i:g\left[i\right]=\gamma}y_{i}\\
\bar{x}_{g} & =\sum_{i:g\left[i\right]=\gamma}x_{i}
\end{align*}


This may be premature optimization, though.


Transformation


Suppose 
Formula $p\left(\theta\right)$


 is a density with respect to a measure 
 Formula $d\theta$


, and you transform

\begin{align*}
\tau & =f\left(\theta\right)
\end{align*}




Then 
 $q\left(\tau\right)$


 is the same density when

\begin{align*}
q\left(\tau\right)d\tau & =p\left(\theta\right)d\theta\Rightarrow\\
q\left(\tau\right) & =p\left(f^{-1}\left(\tau\right)\right)\left|\frac{d\theta}{d\tau}\right|
\end{align*}




\end{document}